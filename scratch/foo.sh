a="'"; cat adt21CountryYears.tsv | parallel --gnu --colsep '\t' --header : 'echo "COPY ( SELECT string_agg(aiddata_id::text,'$a','$a') AS aiddata_ids,title,short_description,long_description FROM aiddata2_1 WHERE recipient_iso3 = '$a'{1}'$a' AND YEAR >= '$a'{2}'$a' AND YEAR <= '$a'{3}'$a' GROUP BY title,short_description,long_description ) TO STDOUT WITH DELIMITER '$a'|'$a' CSV HEADER;"'
| psql aiddata21  | while read line; do url_encode=$( echo "$line" | perl -MURI::Escape -e 'print uri_escape(<STDIN>); print "\n";'); curl -s "http://geocoder.aiddata.wm.edu:8080/CLIFF-2.1.1/parse/text?q=${url_encode}" | jq '.'; done
